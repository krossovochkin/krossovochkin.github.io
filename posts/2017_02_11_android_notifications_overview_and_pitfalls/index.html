<!DOCTYPE html>
<html lang="en-us">
<head>
  <title>[Android] Notifications Overview and Pitfalls</title>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.0/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>
  <script src="https://kit.fontawesome.com/6d5aec2882.js" crossorigin="anonymous"></script>

  <link rel="stylesheet" href="/css/style.css" />

  
  <meta name="theme-color" content="#1e2327">

  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="[Android] Notifications Overview and Pitfalls"/>
<meta name="twitter:description" content="Introduction Notifications are widely used in Android applications. Though API is pretty straightforward, there are some key things that one should know and understand. This article will try to be first step into understanding Notifications API.
Sending Single Notification Notification singleNotification = new NotificationCompat.Builder(this) .setContentTitle(&#34;Title&#34;) .setContentText(&#34;Text&#34;) .setSmallIcon(R.drawable.ic_notification) .build(); NotificationManagerCompat notificationManager = NotificationManagerCompat.*from*(context); notificationManager.notify(notificationId, singleNotification); Key things here:
We use NotificationCompat.Builder to have single interface for creating notifications and let Support Library do all compatibility tricks;"/>
<meta name="twitter:site" content="@krossovochkin"/>

</head>

<body>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-148934073-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


<header>
<nav>
  <ul>
    
    <li class="menu-left"><a href="/">Posts</a></li>
    
    <li class="menu-left"><a href="/about">About</a></li>
    
    
    <li class="menu-right"><a href="https://t.me/krossovochkin_newsletter" target="_blank"><i class="fa-brands fa-telegram fa-xl"></i></a></li>
    
    <li class="menu-right"><a href="https://stackoverflow.com/users/1533933/krossovochkin" target="_blank"><i class="fa-brands fa-stack-overflow fa-xl"></i></a></li>
    
    <li class="menu-right"><a href="https://linkedin.com/in/vasyadrobushkov" target="_blank"><i class="fa-brands fa-linkedin fa-xl"></i></a></li>
    
    <li class="menu-right"><a href="https://facebook.com/vasya.drobushkov" target="_blank"><i class="fa-brands fa-facebook fa-xl"></i></a></li>
    
    <li class="menu-right"><a href="/index.xml" target="_blank"><i class="fa-solid fa-rss fa-xl"></i></a></li>
    
    <li class="menu-right"><a href="https://twitter.com/krossovochkin" target="_blank"><i class="fa-brands fa-twitter fa-xl"></i></a></li>
    
    <li class="menu-right"><a href="https://github.com/krossovochkin" target="_blank"><i class="fa-brands fa-github fa-xl"></i></a></li>
    
  </ul>
</nav>
</header>

<br/>

<div class="meta">

  
    <h1><span class="title">[Android] Notifications Overview and Pitfalls</span></h1>
  
  
    <h3>February 11, 2017</h3>
  

</div>

<main>
<p><a href="https://medium.com/@krossovochkin/android-notifications-overview-and-pitfalls-517d1118ec83"><img src="https://img.shields.io/badge/original-medium-green#badge" alt=""></a></p>
<h1 id="introduction">Introduction</h1>
<p>Notifications are widely used in Android applications. Though API is pretty straightforward, there are some key things that one should know and understand. This article will try to be first step into understanding Notifications API.</p>
<h2 id="sending-single-notification">Sending Single Notification</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Notification</span> <span class="n">singleNotification</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NotificationCompat</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="k">this</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">setContentTitle</span><span class="o">(</span><span class="s">&#34;Title&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">setContentText</span><span class="o">(</span><span class="s">&#34;Text&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">setSmallIcon</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">ic_notification</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">NotificationManagerCompat</span> <span class="n">notificationManager</span> <span class="o">=</span> <span class="n">NotificationManagerCompat</span><span class="o">.*</span><span class="n">from</span><span class="o">*(</span><span class="n">context</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">notificationManager</span><span class="o">.</span><span class="na">notify</span><span class="o">(</span><span class="n">notificationId</span><span class="o">,</span> <span class="n">singleNotification</span><span class="o">);</span>
</span></span></code></pre></div><p><img src="../../img/1_i_FZ2R1UInhmPkXVB1sC9Q.png" alt=""></p>
<p><strong>Key things here:</strong></p>
<ol>
<li>
<p>We use NotificationCompat.Builder to have single interface for creating notifications and let Support Library do all compatibility tricks;</p>
</li>
<li>
<p>Content title, context text and small icon are **required **to show notification;</p>
</li>
<li>
<p>To show notification we should use NotificationManagerCompat (NotificationManagerCompat.from(context)) instead of system NotificationManager (context.getSystemService(NOTIFICATION_SERVICE)) — for compatibility;</p>
</li>
<li>
<p>Each notification should have notificationId. To send **new **notification to the system notificationId should be <strong>unique</strong>.</p>
</li>
</ol>
<h2 id="updating-single-notification">Updating Single Notification</h2>
<p>To update notification (that is already showing — <strong>active</strong>) one should just send new notification with the <strong>same id</strong>. Old notification will be replaced with new one.</p>
<h2 id="handling-clicks-on-notification">Handling clicks on notification</h2>
<p>To handle clicking on notification one should set content intent.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">Activity</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">intent</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(...);</span> <span class="c1">// add some extras here
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="n">PendingIntent</span> <span class="n">pendingIntent</span> <span class="o">=</span> <span class="n">PendingIntent</span><span class="o">.</span><span class="na">getActivity</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">requestCode</span><span class="o">,</span> <span class="n">intent</span><span class="o">,</span> <span class="n">flags</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">builder</span><span class="o">.</span><span class="na">setContentIntent</span><span class="o">(</span><span class="n">pendingIntent</span><span class="o">);</span>
</span></span></code></pre></div><p><strong>Key things here:</strong></p>
<ol>
<li>
<p>PendingIntent is a special “token” (reference to Intent).
It can be retrieved from static methods such asPendingIntent#getActivity, PendingIntent#getBroadcast, PendingIntent#getService etc. to start activity or service or send broadcast;</p>
</li>
<li>
<p>requestCode is some kind of id of PendingIntent (so it doesn’t have same sense as requestCode in #startActivityForResult) — one can use it to distinguish two PendingIntents that should be different;</p>
</li>
<li>
<p>intent is an Intent to be sent on clicking notification;</p>
</li>
<li>
<p>PendingIntents are references to tokens which describe data used to retrieve this PendingIntent.
This means that retrieving PendingIntent with <strong>the same data</strong> will return reference to **the same token **(see example below);</p>
</li>
<li>
<p>flags affect lifecycle of PendingIntent tokens.
Full list of flags one can see in <a href="https://developer.android.com/reference/android/app/PendingIntent.html">official documentation</a>.
For example, PendingIntent.FLAG_UPDATE_CURRENT flag means that if pending intent with given configuration doesn’t exist in the system — it will be created. Otherwise, it will be overwritten by new one.</p>
</li>
<li>
<p>Adding different extras to original intent will return <strong>the same</strong> PendingIntent.
Different PendingIntents will be created for original intents for which Intents.filterEquals returns false.
Also different PendingIntents will be created for different requestCodes.</p>
</li>
</ol>
<p>Example to illustrate common mistake with PendingIntents lifecycle and updating.
Consider we have MainActivity that prints text from intent extra with key &ldquo;KEY_TEXT&rdquo;.
And we send notifications like following:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">sendNotification</span><span class="o">(</span><span class="kt">int</span> <span class="n">notificationId</span><span class="o">,</span> <span class="kt">int</span> <span class="n">requestCode</span><span class="o">,</span> <span class="n">String</span> <span class="n">text</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">MainActivity</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">intent</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">&#34;KEY_TEXT&#34;</span><span class="o">,</span> <span class="n">text</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">PendingIntent</span> <span class="n">pendingIntent</span> <span class="o">=</span> <span class="n">getActivity</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">requestCode</span><span class="o">,</span> <span class="n">intent</span><span class="o">,</span> <span class="n">FLAG_UPDATE_CURRENT</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">Notification</span> <span class="n">notification</span> <span class="o">=</span> <span class="o">...</span> <span class="c1">// create notification as shown above
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">.</span><span class="na">setContentIntent</span><span class="o">(</span><span class="n">pendingIntent</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">notificationManager</span><span class="o">.</span><span class="na">notify</span><span class="o">(</span><span class="n">notificationId</span><span class="o">,</span> <span class="n">pendingIntent</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>And let’s send two notifications:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">sendNotification</span><span class="o">(</span><span class="n">1</span><span class="o">,</span> <span class="n">0</span><span class="o">,</span> <span class="s">&#34;Text 1&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">sendNotification</span><span class="o">(</span><span class="n">2</span><span class="o">,</span> <span class="n">0</span><span class="o">,</span> <span class="s">&#34;Text 2&#34;</span><span class="o">);</span>
</span></span></code></pre></div><p>As a result clicking on any of the notification will end up with opening MainActivity and showing &ldquo;Text 2&rdquo;. Why?
Because request codes for PendingIntents are the same, and FLAG_UPDATE_CURRENT updated PendingIntent when new notification is sent.
So, both notifications have the same PendingIntent (with latest original Intent posted) even considering the fact that extras in intents were different.</p>
<p>One way to avoid this is to use different request codes (e.g. use notificationId as request code).</p>
<p>Another way is to set different actions, e.g. like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">intent</span><span class="o">.</span><span class="na">setAction</span><span class="o">(</span><span class="n">Long</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()))</span>
</span></span></code></pre></div><h2 id="handling-dismissing-notification">Handling dismissing notification</h2>
<p>Handling dismissing notification is the same as handling clicking notifications. But different method in builder is used:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">builder</span><span class="o">.</span><span class="na">setDeleteIntent</span><span class="o">(</span><span class="n">pendingIntent</span><span class="o">);</span>
</span></span></code></pre></div><p>Delete intent will be sent when user manually dismisses notification or when user clicks on “Clear all notifications” button in notification tray.</p>
<p>Clicking on notification itself dismisses notification, but delete intent will not be sent in this case. Instead content intent will be sent.</p>
<h2 id="notifications-grouping">Notifications grouping</h2>
<p>Each notification can be assigned to a group with some GROUP_KEY.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">builder</span><span class="o">.</span><span class="na">setGroup</span><span class="o">(</span><span class="n">GROUP_KEY</span><span class="o">);</span>
</span></span></code></pre></div><p>Specifying group on some notification does <strong>nothing</strong>, but only marks that notification now is a part of a group.
If you mark two notifications with the same group, these notifications will **not **be grouped automatically.</p>
<p>There is special notification called “Summary notification”.
To make notification “Summary notification” one should call:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">builder</span><span class="o">.</span><span class="na">setGroup</span><span class="o">(</span><span class="n">GROUP_KEY</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">builder</span><span class="o">.</span><span class="na">setGroupSummary</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span></code></pre></div><p>In this case following will happen:</p>
<ol>
<li>On phone only Summary notification will be shown. Any other non-summary notification with the same group key as Summary notification will not be shown</li>
</ol>
<p><img src="../../img/1_ioGcmNRdinQLPVIS-tI0FA.png" alt=""></p>
<ol start="2">
<li>On wearable device Summary notification will not be shown. Instead all non-summary notifications will be shown (grouped automatically by the system).</li>
</ol>
<p><img src="../../img/1_wWiiDHysRTNz_bGQncwa5g.png" alt=""></p>
<p><img src="../../img/1_y8IMp1FbJegM-HvQtvIg1A.png" alt=""></p>
<h2 id="accessing-notifications-in-notification-tray">Accessing notifications in notification tray</h2>
<p>In order to update notifications it is useful to access currently showing notifications.
For example, if we have Summary notification then we might want to show number of notifications in this group. To do this we should know how many notifications of this group is showing at the moment.</p>
<p>Unfortunately, there is no way to do that prior to API 23. Since API 23 there is method:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">if</span> <span class="o">(</span><span class="n">Build</span><span class="o">.</span><span class="na">VERSION</span><span class="o">.</span><span class="na">SDK_INT</span> <span class="o">&gt;=</span> <span class="n">Build</span><span class="o">.</span><span class="na">VERSION_CODES</span><span class="o">.</span><span class="na">M</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">NotificationManager</span> <span class="n">notificationManager</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getSystemService</span><span class="o">(</span><span class="n">NOTIFICATION_MANAGER</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">StatusBarNotification</span><span class="o">[]</span> <span class="n">notifications</span> <span class="o">=</span> <span class="n">notificationManager</span><span class="o">.</span><span class="na">getActiveNotifications</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><blockquote>
<p><strong>Important</strong>: here we need NotificationManager and not NotificationManagerCompat.</p>
</blockquote>
<p><strong>Note</strong>: When only summary notification is currently visible to user in notification tray, getActiveNotifications returns whole list of notifications (including ones that grouped in summary and not visible on phone in notification tray).</p>
<blockquote>
<p><strong>Important</strong>: Don’t use emulators (neither Android official emulator nor Genymotion) for implementing notifications grouping, as in the case described aboveNotificationManager#getActiveNotifications() returns only summary notification and doesn’t list notifications that were sent, but currently not visible to user..</p>
</blockquote>
<h2 id="notification-styles">Notification Styles</h2>
<p>Here the best thing one can do is look at available Styles in <a href="https://developer.android.com/reference/android/app/Notification.Style.html">documentation</a>. Knowing available styles is important to find one that fits your needs.
For example, for grouping notifications InboxStyle is very useful.
We will use it below.</p>
<h2 id="example-of-grouping-notifications">Example of grouping notifications</h2>
<p>Collecting everything above, we finally can do something useful.</p>
<p>Snippet below does the following:</p>
<ul>
<li>If no notifications in notification tray: send single notification</li>
<li>If only one notification is shown in notification tray: send single notification and group notifications into summary notification (with previews of current notifications)</li>
<li>If summary notification is showing: send single notification and update group notification</li>
</ul>
<p>Call sendNotification multiple times with the same group key, and see what happens.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span> <span class="kt">void</span> <span class="nf">sendNotification</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">String</span> <span class="n">groupKey</span><span class="o">,</span> <span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">NotificationManager</span> <span class="n">notificationManager</span> <span class="o">=</span> <span class="o">(</span><span class="n">NotificationManager</span><span class="o">)</span> <span class="n">getSystemService</span><span class="o">(*</span><span class="n">NOTIFICATION_SERVICE</span><span class="o">*);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">boolean</span> <span class="n">shouldShowGroupNotification</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">List</span><span class="o">&lt;</span><span class="n">CharSequence</span><span class="o">&gt;</span> <span class="n">currentNotificationMessages</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">    <span class="n">currentNotificationMessages</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">Build</span><span class="o">.</span><span class="na">VERSION</span><span class="o">.*</span><span class="n">SDK_INT</span> <span class="o">*&gt;=</span> <span class="n">Build</span><span class="o">.</span><span class="na">VERSION_CODES</span><span class="o">.*</span><span class="n">M</span><span class="o">*)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="o">(</span><span class="n">StatusBarNotification</span> <span class="n">sbn</span> <span class="o">:</span> <span class="n">notificationManager</span><span class="o">.</span><span class="na">getActiveNotifications</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">sbn</span><span class="o">.</span><span class="na">getId</span><span class="o">()</span> <span class="o">!=</span> <span class="o">*</span><span class="n">GROUP_ID</span> <span class="o">*&amp;&amp;</span> <span class="n">groupKey</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="n">sbn</span><span class="o">.</span><span class="na">getNotification</span><span class="o">().</span><span class="na">getGroup</span><span class="o">()))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">CharSequence</span> <span class="n">text</span> <span class="o">=</span> <span class="n">sbn</span><span class="o">.</span><span class="na">getNotification</span><span class="o">().</span><span class="na">extras</span><span class="o">.</span><span class="na">getCharSequence</span><span class="o">(*</span><span class="n">EXTRA_TEXT</span><span class="o">*);</span>
</span></span><span class="line"><span class="cl">                <span class="n">currentNotificationMessages</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">text</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">shouldShowGroupNotification</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                <span class="k">break</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">showSingleNotification</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">groupKey</span><span class="o">,</span> <span class="n">message</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">shouldShowGroupNotification</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">showGroupNotification</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">groupKey</span><span class="o">,</span> <span class="n">currentNotificationMessages</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="kt">void</span> <span class="nf">showSingleNotification</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">String</span> <span class="n">groupKey</span><span class="o">,</span> <span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">notificationId</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">System</span><span class="o">.*</span><span class="n">currentTimeMillis</span><span class="o">*()</span> <span class="o">/</span> <span class="n">1000</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">MainActivity</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">PendingIntent</span> <span class="n">pendingIntent</span> <span class="o">=</span> <span class="n">PendingIntent</span><span class="o">.*</span><span class="n">getActivity</span><span class="o">*(</span><span class="n">context</span><span class="o">,</span> <span class="n">notificationId</span><span class="o">,</span> <span class="n">intent</span><span class="o">,</span> <span class="n">PendingIntent</span><span class="o">.*</span><span class="n">FLAG_UPDATE_CURRENT</span><span class="o">*);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">Notification</span> <span class="n">singleNotification</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NotificationCompat</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="n">context</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="o">.</span><span class="na">setContentTitle</span><span class="o">(</span><span class="s">&#34;Title&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="o">.</span><span class="na">setContentText</span><span class="o">(</span><span class="n">message</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="o">.</span><span class="na">setGroup</span><span class="o">(</span><span class="n">groupKey</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="o">.</span><span class="na">setSmallIcon</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">ic_notification</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="o">.</span><span class="na">setContentIntent</span><span class="o">(</span><span class="n">pendingIntent</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">NotificationManagerCompat</span> <span class="n">notificationManager</span> <span class="o">=</span> <span class="n">NotificationManagerCompat</span><span class="o">.*</span><span class="n">from</span><span class="o">*(</span><span class="n">context</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">notificationManager</span><span class="o">.</span><span class="na">notify</span><span class="o">(</span><span class="n">notificationId</span><span class="o">,</span> <span class="n">singleNotification</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="kt">void</span> <span class="nf">showGroupNotification</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">String</span> <span class="n">groupKey</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">CharSequence</span><span class="o">&gt;</span> <span class="n">previousNotificationsTexts</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">NotificationCompat</span><span class="o">.</span><span class="na">InboxStyle</span> <span class="n">style</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NotificationCompat</span><span class="o">.</span><span class="na">InboxStyle</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="o">(</span><span class="n">CharSequence</span> <span class="n">text</span><span class="o">:</span> <span class="n">previousNotificationsTexts</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">style</span><span class="o">.</span><span class="na">addLine</span><span class="o">(</span><span class="n">text</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">groupCount</span> <span class="o">=</span> <span class="n">previousNotificationsTexts</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">+</span> <span class="n">1</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">style</span><span class="o">.</span><span class="na">setSummaryText</span><span class="o">(</span><span class="n">groupCount</span> <span class="o">+</span> <span class="s">&#34; new notifications&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">Notification</span> <span class="n">groupNotification</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NotificationCompat</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="n">context</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="o">.</span><span class="na">setStyle</span><span class="o">(</span><span class="n">style</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="o">.</span><span class="na">setContentTitle</span><span class="o">(</span><span class="s">&#34;Group Title&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="o">.</span><span class="na">setContentText</span><span class="o">(</span><span class="s">&#34;Group Text&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="o">.</span><span class="na">setSmallIcon</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">ic_notification</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="o">.</span><span class="na">setGroup</span><span class="o">(</span><span class="n">groupKey</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="o">.</span><span class="na">setGroupSummary</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">NotificationManagerCompat</span> <span class="n">notificationManager</span> <span class="o">=</span> <span class="n">NotificationManagerCompat</span><span class="o">.*</span><span class="n">from</span><span class="o">*(</span><span class="n">context</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">notificationManager</span><span class="o">.</span><span class="na">notify</span><span class="o">(*</span><span class="n">GROUP_ID</span><span class="o">*,</span> <span class="n">groupNotification</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p><img src="../../img/1_fSahpzH6zC7WKVATJUAfCw.png" alt=""></p>
<p><img src="../../img/1_UY8HQlQ0tNsbwTHCDLZrog.png" alt=""></p>
<p><img src="../../img/1_ocnLjgr4bpJ93Zf3iY4yWw.png" alt=""></p>
<h2 id="further-improvements">Further improvements</h2>
<p>Things that are not covered here is updating group notification on clicking on notification or on dismissing notification.
But this is like a union of “Handle clicking/dismissing notification” with “Update (summary) notification”.
Consider this as a homework :)</p>
<h2 id="referencesfurther-reading">References/Further reading</h2>
<p><a href="https://developer.android.com/guide/topics/ui/notifiers/notifications.html"><strong>Notifications | Android Developers</strong></a>
<a href="https://developer.android.com/training/notify-user/index.html"><strong>Notifying the User | Android Developers</strong></a>
<a href="https://developer.android.com/training/wearables/notifications/index.html"><strong>Adding Wearable Features to Notifications | Android Developers</strong></a></p>

</main>


<hr/>

<footer>
<nav>
  <ul>
    
    <li class="menu-left"><a href="/">Posts</a></li>
    
    <li class="menu-left"><a href="/about">About</a></li>
    
    
    <li class="menu-right"><a href="https://t.me/krossovochkin_newsletter" target="_blank"><i class="fa-brands fa-telegram fa-xl"></i></a></li>
    
    <li class="menu-right"><a href="https://stackoverflow.com/users/1533933/krossovochkin" target="_blank"><i class="fa-brands fa-stack-overflow fa-xl"></i></a></li>
    
    <li class="menu-right"><a href="https://linkedin.com/in/vasyadrobushkov" target="_blank"><i class="fa-brands fa-linkedin fa-xl"></i></a></li>
    
    <li class="menu-right"><a href="https://facebook.com/vasya.drobushkov" target="_blank"><i class="fa-brands fa-facebook fa-xl"></i></a></li>
    
    <li class="menu-right"><a href="/index.xml" target="_blank"><i class="fa-solid fa-rss fa-xl"></i></a></li>
    
    <li class="menu-right"><a href="https://twitter.com/krossovochkin" target="_blank"><i class="fa-brands fa-twitter fa-xl"></i></a></li>
    
    <li class="menu-right"><a href="https://github.com/krossovochkin" target="_blank"><i class="fa-brands fa-github fa-xl"></i></a></li>
    
  </ul>
</nav>
</footer>


</body>

</html>