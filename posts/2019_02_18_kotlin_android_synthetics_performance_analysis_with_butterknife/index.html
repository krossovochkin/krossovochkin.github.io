<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Kotlin-android-synthetics performance analysis (with ButterKnife) :: Krossovochkin — Android Developer</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="Introduction After comment that synthetic is no longer recommended practice and some arguments I decided to go deeper into issue with performance of kotlin-android-synthetics by analyzing generated Java and byte code and comparing to other approaches (such as vanilla-*findViewById *and ButterKnife).
Vanilla-findViewById This is sample Activity we’ll work with throughout the article. Approach with *findViewById *will be our baseline.
Sample consists of:
  *Activity *class
  One *TextView *property inside *Activity *with *lateinit *modifier" />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://krossovochkin.github.io/posts/2019_02_18_kotlin_android_synthetics_performance_analysis_with_butterknife/" />




<link rel="stylesheet" href="https://krossovochkin.github.io/assets/style.css">

  <link rel="stylesheet" href="https://krossovochkin.github.io/assets/yellow.css">






<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://krossovochkin.github.io/img/apple-touch-icon-144-precomposed.png">

  <link rel="shortcut icon" href="https://krossovochkin.github.io/img/favicon/yellow.png">



<meta name="twitter:card" content="summary" />

  <meta name="twitter:site" content="krossovochkin" />

<meta name="twitter:creator" content="krossovochkin" />


<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Kotlin-android-synthetics performance analysis (with ButterKnife) :: Krossovochkin">
<meta property="og:description" content="Introduction After comment that synthetic is no longer recommended practice and some arguments I decided to go deeper into issue with performance of kotlin-android-synthetics by analyzing generated Java and byte code and comparing to other approaches (such as vanilla-*findViewById *and ButterKnife).
Vanilla-findViewById This is sample Activity we’ll work with throughout the article. Approach with *findViewById *will be our baseline.
Sample consists of:
  *Activity *class
  One *TextView *property inside *Activity *with *lateinit *modifier" />
<meta property="og:url" content="https://krossovochkin.github.io/posts/2019_02_18_kotlin_android_synthetics_performance_analysis_with_butterknife/" />
<meta property="og:site_name" content="Kotlin-android-synthetics performance analysis (with ButterKnife)" />

  <meta property="og:image" content="https://krossovochkin.github.io/">

<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">


  <meta property="article:published_time" content="2019-02-18 00:00:00 &#43;0000 UTC" />












</head>
<body class="">


<div class="container center headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    Krossovochkin
  </div>
</a>

    </div>
    <div class="menu-trigger">menu</div>
  </div>
  
    <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">About me</a></li>
        
      
        
          <li><a href="/">Posts</a></li>
        
      
      
    

    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">About me</a></li>
      
    
      
        <li><a href="/">Posts</a></li>
      
    
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<div class="post">
  <h1 class="post-title">
    <a href="https://krossovochkin.github.io/posts/2019_02_18_kotlin_android_synthetics_performance_analysis_with_butterknife/">Kotlin-android-synthetics performance analysis (with ButterKnife)</a></h1>
  <div class="post-meta">
    
      <span class="post-date">
        2019-02-18 
      </span>
    
    
    <span class="post-author">::
      Vasya Drobushkov
    </span>
    
  </div>

  
  <span class="post-tags">
    
    #<a href="https://krossovochkin.github.io/tags/android/">android</a>&nbsp;
    
    #<a href="https://krossovochkin.github.io/tags/synthetics/">synthetics</a>&nbsp;
    
    #<a href="https://krossovochkin.github.io/tags/butterknife/">butterknife</a>&nbsp;
    
    #<a href="https://krossovochkin.github.io/tags/findviewbyid/">findViewById</a>&nbsp;
    
  </span>
  

  

  

  <div class="post-content"><div>
        <p><a href="https://proandroiddev.com/kotlin-android-synthetics-performance-analysis-with-butterknife-90a54ca4325d"><img src="https://img.shields.io/badge/original-proandroiddev-green#badge" alt=""></a></p>
<h1 id="introduction">Introduction<a href="#introduction" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<p>After comment that <a href="https://android-review.googlesource.com/c/platform/frameworks/support/+/882241">synthetic is no longer recommended practice</a> and <a href="https://proandroiddev.com/the-argument-over-kotlin-synthetics-735305dd4ed0">some arguments</a> I decided to go deeper into issue with performance of <em>kotlin-android-synthetics</em> by analyzing generated Java and byte code and comparing to other approaches (such as vanilla-*findViewById *and <em>ButterKnife</em>).</p>
<h2 id="vanilla-findviewbyid">Vanilla-findViewById<a href="#vanilla-findviewbyid" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>This is sample Activity we’ll work with throughout the article.
Approach with *findViewById *will be our baseline.</p>
<p>Sample consists of:</p>
<ul>
<li>
<p>*Activity *class</p>
</li>
<li>
<p>One *TextView *property inside *Activity *with *lateinit *modifier</p>
</li>
<li>
<p>Initializing *TextView *property in *onCreate *in <em>Activity</em></p>
</li>
<li>
<p>Setting dynamically few properties on *TextView *afterwards</p>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MainActivity</span> : AppCompatActivity() {

    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">lateinit</span> <span style="color:#66d9ef">var</span> textView: TextView

    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">onCreate</span>(savedInstanceState: Bundle?) {
        <span style="color:#66d9ef">super</span>.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)

        textView = findViewById(R.id.textView)

        update()
    }

    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">update</span>() {
        textView.text = <span style="color:#e6db74">&#34;Text&#34;</span>
        textView.setTextColor(Color.RED)
        textView.textSize = <span style="color:#ae81ff">14.0f</span>
    }
}
</code></pre></div><p>Here is what we’ll get if we try to look at generated java code:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MainActivity</span> <span style="color:#66d9ef">extends</span> AppCompatActivity <span style="color:#f92672">{</span>
   <span style="color:#66d9ef">private</span> TextView textView<span style="color:#f92672">;</span>
   <span style="color:#66d9ef">private</span> HashMap _$_findViewCache<span style="color:#f92672">;</span>

   <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">onCreate</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@Nullable</span> Bundle savedInstanceState<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      <span style="color:#66d9ef">super</span><span style="color:#f92672">.</span><span style="color:#a6e22e">onCreate</span><span style="color:#f92672">(</span>savedInstanceState<span style="color:#f92672">);</span>
      <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">setContentView</span><span style="color:#f92672">(-</span>1300009<span style="color:#f92672">);</span>
      View var10001 <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">findViewById</span><span style="color:#f92672">(-</span>1000050<span style="color:#f92672">);</span>
      Intrinsics<span style="color:#f92672">.</span><span style="color:#a6e22e">checkExpressionValueIsNotNull</span><span style="color:#f92672">(</span>var10001<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;findViewById(R.id.textView)&#34;</span><span style="color:#f92672">);</span>
      <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">textView</span> <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>TextView<span style="color:#f92672">)</span>var10001<span style="color:#f92672">;</span>
      <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">update</span><span style="color:#f92672">();</span>
   <span style="color:#f92672">}</span>

   <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">update</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
      TextView var10000 <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">textView</span><span style="color:#f92672">;</span>
      <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">textView</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
         Intrinsics<span style="color:#f92672">.</span><span style="color:#a6e22e">throwUninitializedPropertyAccessException</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;textView&#34;</span><span style="color:#f92672">);</span>
      <span style="color:#f92672">}</span>

      var10000<span style="color:#f92672">.</span><span style="color:#a6e22e">setText</span><span style="color:#f92672">((</span>CharSequence<span style="color:#f92672">)</span><span style="color:#e6db74">&#34;Text&#34;</span><span style="color:#f92672">);</span>
      var10000 <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">textView</span><span style="color:#f92672">;</span>
      <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">textView</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
         Intrinsics<span style="color:#f92672">.</span><span style="color:#a6e22e">throwUninitializedPropertyAccessException</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;textView&#34;</span><span style="color:#f92672">);</span>
      <span style="color:#f92672">}</span>

      var10000<span style="color:#f92672">.</span><span style="color:#a6e22e">setTextColor</span><span style="color:#f92672">(-</span>65536<span style="color:#f92672">);</span>
      var10000 <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">textView</span><span style="color:#f92672">;</span>
      <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">textView</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
         Intrinsics<span style="color:#f92672">.</span><span style="color:#a6e22e">throwUninitializedPropertyAccessException</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;textView&#34;</span><span style="color:#f92672">);</span>
      <span style="color:#f92672">}</span>

      var10000<span style="color:#f92672">.</span><span style="color:#a6e22e">setTextSize</span><span style="color:#f92672">(</span>14<span style="color:#f92672">.</span><span style="color:#a6e22e">0F</span><span style="color:#f92672">);</span>
   <span style="color:#f92672">}</span>

   <span style="color:#66d9ef">public</span> View <span style="color:#a6e22e">_$_findCachedViewById</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> var1<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">_$_findViewCache</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
         <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">_$_findViewCache</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashMap<span style="color:#f92672">();</span>
      <span style="color:#f92672">}</span>

      View var2 <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>View<span style="color:#f92672">)</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">_$_findViewCache</span><span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>var1<span style="color:#f92672">);</span>
      <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>var2 <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
         var2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">findViewById</span><span style="color:#f92672">(</span>var1<span style="color:#f92672">);</span>
         <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">_$_findViewCache</span><span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span>var1<span style="color:#f92672">,</span> var2<span style="color:#f92672">);</span>
      <span style="color:#f92672">}</span>

      <span style="color:#66d9ef">return</span> var2<span style="color:#f92672">;</span>
   <span style="color:#f92672">}</span>

   <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">_$_clearFindViewByIdCache</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
      <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">_$_findViewCache</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
         <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">_$_findViewCache</span><span style="color:#f92672">.</span><span style="color:#a6e22e">clear</span><span style="color:#f92672">();</span>
      <span style="color:#f92672">}</span>

   <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>We immediately have a number of questions:</p>
<ul>
<li>
<p>We haven’t used synthetics in this <em>Activity</em>, we just have apply plugin: &lsquo;kolin-android-extensions&rsquo; in our <em>build.gradle</em> (which is added by default).
Why we have <em><strong>_$_findViewCache</strong></em>, <em><strong>_$_findCachedViewById</strong></em> and <em><strong>_$_clearFindViewByIdCache</strong></em>?</p>
</li>
<li>
<p>Why we have three null-checks for our *TextView *property (which can throw <em>throwUninitializedPropertyAccessException)?</em></p>
</li>
<li>
<p>If keys for view cache are primitive integers, why we have <em>HashMap</em>? Keys in HashMap are Integer objects, so each *get *with primitive int will end up with autoboxing primitive value into Integer object (which pollutes memory)</p>
</li>
</ul>
<p>Let’s try to answer these questions one by one.</p>
<h3 id="code-generation-issue">Code generation issue<a href="#code-generation-issue" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>I have no exact answer to the question why we have synthetic code generated for class which hasn’t used them.
Most likely (as <a href="https://kotlinlang.org/docs/tutorials/android-plugin.html#layoutcontainer-support">*LayoutContainers *are supported</a> — including <em>Activity</em>, <em>Fragment</em>, <em>View</em>) code is generated for all these classes without checking whether some features of synthetics are actually used in them.
Maybe it is just easier to generate to all supported classes than to check where exactly code is needed.
Also it might help with incremental builds as after code generation and first build success there is no need to redo it again.</p>
<p>This might look like an overhead from code perspective (and it basically is). Thankfully we have <em>multidex</em>, so number of methods is no longer an issue.
For release build *ProGuard *(or <em>R8</em>) will remove unused methods and fields and will do many other optimizations so the problem will gone (eventually there even won’t be <em>update()</em> method in resulting release byte-code as code will be inlined into *onCreate *method)</p>
<h3 id="lateinit-checks">Lateinit checks<a href="#lateinit-checks" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>Various *Intrinsic *checks are generated by Kotlin for Java. On Kotlin level it is easy to enforce and check that values are not null/nullable etc., but when it comes to Java there are no guarantees that everything will work well.</p>
<p>As *TextView *property is not final it is possible that between two lines value will be set to <em>null</em>. Intrinsic checks ensure that if some contract is violated exception is thrown as soon as possible.</p>
<p>This again might look as an overhead if we know that we’ll initialize *TextView *in *onCreate *(and we’ll check that value is not null) and that we’ll not try to change property concurrently and that we don’t call <em>update()</em> method before <em>onCreate</em>, so that additional checks are not really required (or at least it could be one).
But it is something we know, not the compiler.</p>
<p>One could look at generated Java code and decide to do little trick with <em>.apply</em> function:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">update</span>() {
    textView.apply {
        text = <span style="color:#e6db74">&#34;Text&#34;</span>
        setTextColor(Color.*RED*)
        textSize = <span style="color:#ae81ff">14.0f</span>
    }
}
</code></pre></div><p>So the resulting Java code will be:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">update</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
   TextView var10000 <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">textView</span><span style="color:#f92672">;</span>
   <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">textView</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      Intrinsics<span style="color:#f92672">.*</span>throwUninitializedPropertyAccessException<span style="color:#f92672">*(</span><span style="color:#e6db74">&#34;textView&#34;</span><span style="color:#f92672">);</span>
   <span style="color:#f92672">}</span>

   TextView var1 <span style="color:#f92672">=</span> var10000<span style="color:#f92672">;</span>
   var1<span style="color:#f92672">.</span><span style="color:#a6e22e">setText</span><span style="color:#f92672">((</span>CharSequence<span style="color:#f92672">)</span><span style="color:#e6db74">&#34;Text&#34;</span><span style="color:#f92672">);</span>
   var1<span style="color:#f92672">.</span><span style="color:#a6e22e">setTextColor</span><span style="color:#f92672">(-</span>65536<span style="color:#f92672">);</span>
   var1<span style="color:#f92672">.</span><span style="color:#a6e22e">setTextSize</span><span style="color:#f92672">(</span>14<span style="color:#f92672">.</span><span style="color:#a6e22e">0F</span><span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>So we have only one check and then update all properties on local property. Neat.</p>
<p>Though such optimizations are definitely premature as anyway in release build ProGuard will do better optimization work without making your code look a bit weird.</p>
<h3 id="hashmapsparsearray">HashMap/SparseArray<a href="#hashmapsparsearray" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>Why <em>HashMap</em> is used instead of <em>SparseArray</em>?</p>
<p>As keys are integers each lookup will trigger boxing of the integer value which will badly impact memory usage and make GC to trigger more often.
Seems *SparseArray *is better option because we’ll have primitive integers as keys, why it is not used?</p>
<p>Actually there is a way to generate code with <em>SparseArray</em>. For that it is needed to add to <em>build.gradle</em>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-groovy" data-lang="groovy">androidExtensions <span style="color:#f92672">{</span>
    defaultCacheImplementation <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;SPARSE_ARRAY&#34;</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>After that we’ll have <em>SparseArray</em> as cache for views.</p>
<p>Also it is possible to disable cache by using “NONE”, though this option hardly ever useful.</p>
<h3 id="result">Result<a href="#result" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>To conclude, evaluation of vanilla approach:</p>
<ul>
<li>one-time initialization (in <em>onCreate</em>)</li>
<li>fast subsequent getters (property keeps reference to <em>View</em>)
– a lot of boilerplate (properties, *findViewById *calls)</li>
</ul>
<h2 id="butterknife">ButterKnife<a href="#butterknife" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>Let’s look at the same example with ButterKnife:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ButterKnifeAcivity</span> : AppCompatActivity() {

    @BindView(R.id.textView)
    <span style="color:#66d9ef">lateinit</span> <span style="color:#66d9ef">var</span> textView: TextView

    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">onCreate</span>(savedInstanceState: Bundle?) {
        <span style="color:#66d9ef">super</span>.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)

        ButterKnife.bind(<span style="color:#66d9ef">this</span>)

        update()
    }

    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">update</span>() {
        textView.text = <span style="color:#e6db74">&#34;Text&#34;</span>
        textView.setTextColor(Color.RED)
        textView.textSize = <span style="color:#ae81ff">14.0f</span>
    }
}
</code></pre></div><p>Generated Java code (synthetics part is removed):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ButterKnifeAcivity</span> <span style="color:#66d9ef">extends</span> AppCompatActivity <span style="color:#f92672">{</span>
   <span style="color:#a6e22e">@BindView</span><span style="color:#f92672">(-</span>1000050<span style="color:#f92672">)</span>
   <span style="color:#a6e22e">@NotNull</span>
   <span style="color:#66d9ef">public</span> TextView textView<span style="color:#f92672">;</span>

   <span style="color:#a6e22e">@NotNull</span>
   <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">final</span> TextView <span style="color:#a6e22e">getTextView</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
      TextView var10000 <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">textView</span><span style="color:#f92672">;</span>
      <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">textView</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
         Intrinsics<span style="color:#f92672">.</span><span style="color:#a6e22e">throwUninitializedPropertyAccessException</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;textView&#34;</span><span style="color:#f92672">);</span>
      <span style="color:#f92672">}</span>

      <span style="color:#66d9ef">return</span> var10000<span style="color:#f92672">;</span>
   <span style="color:#f92672">}</span>

   <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setTextView</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@NotNull</span> TextView var1<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      Intrinsics<span style="color:#f92672">.</span><span style="color:#a6e22e">checkParameterIsNotNull</span><span style="color:#f92672">(</span>var1<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;&lt;set-?&gt;&#34;</span><span style="color:#f92672">);</span>
      <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">textView</span> <span style="color:#f92672">=</span> var1<span style="color:#f92672">;</span>
   <span style="color:#f92672">}</span>

   <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">onCreate</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@Nullable</span> Bundle savedInstanceState<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      <span style="color:#66d9ef">super</span><span style="color:#f92672">.</span><span style="color:#a6e22e">onCreate</span><span style="color:#f92672">(</span>savedInstanceState<span style="color:#f92672">);</span>
      <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">setContentView</span><span style="color:#f92672">(-</span>1300009<span style="color:#f92672">);</span>
      ButterKnife<span style="color:#f92672">.</span><span style="color:#a6e22e">bind</span><span style="color:#f92672">((</span>Activity<span style="color:#f92672">)</span><span style="color:#66d9ef">this</span><span style="color:#f92672">);</span>
      <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">update</span><span style="color:#f92672">();</span>
   <span style="color:#f92672">}</span>

   <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">update</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
      TextView var10000 <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">textView</span><span style="color:#f92672">;</span>
      <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">textView</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
         Intrinsics<span style="color:#f92672">.</span><span style="color:#a6e22e">throwUninitializedPropertyAccessException</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;textView&#34;</span><span style="color:#f92672">);</span>
      <span style="color:#f92672">}</span>

      var10000<span style="color:#f92672">.</span><span style="color:#a6e22e">setText</span><span style="color:#f92672">((</span>CharSequence<span style="color:#f92672">)</span><span style="color:#e6db74">&#34;Text&#34;</span><span style="color:#f92672">);</span>
      var10000 <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">textView</span><span style="color:#f92672">;</span>
      <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">textView</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
         Intrinsics<span style="color:#f92672">.</span><span style="color:#a6e22e">throwUninitializedPropertyAccessException</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;textView&#34;</span><span style="color:#f92672">);</span>
      <span style="color:#f92672">}</span>

      var10000<span style="color:#f92672">.</span><span style="color:#a6e22e">setTextColor</span><span style="color:#f92672">(-</span>65536<span style="color:#f92672">);</span>
      var10000 <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">textView</span><span style="color:#f92672">;</span>
      <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">textView</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
         Intrinsics<span style="color:#f92672">.</span><span style="color:#a6e22e">throwUninitializedPropertyAccessException</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;textView&#34;</span><span style="color:#f92672">);</span>
      <span style="color:#f92672">}</span>

      var10000<span style="color:#f92672">.</span><span style="color:#a6e22e">setTextSize</span><span style="color:#f92672">(</span>14<span style="color:#f92672">.</span><span style="color:#a6e22e">0F</span><span style="color:#f92672">);</span>
   <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>So, basically everything is the same. The difference is only that additional getter and setter for our *TextView *was generated.
It is actually redundant (and will be removed by <em>ProGuard</em>), because *ButterKnife *injector will work directly on field:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ButterKnifeAcivity_ViewBinding</span> <span style="color:#66d9ef">implements</span> Unbinder <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">private</span> ButterKnifeAcivity target<span style="color:#f92672">;</span>

  <span style="color:#a6e22e">@UiThread</span>
  <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ButterKnifeAcivity_ViewBinding</span><span style="color:#f92672">(</span>ButterKnifeAcivity target<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">this</span><span style="color:#f92672">(</span>target<span style="color:#f92672">,</span> target<span style="color:#f92672">.</span><span style="color:#a6e22e">getWindow</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getDecorView</span><span style="color:#f92672">());</span>
  <span style="color:#f92672">}</span>

  <span style="color:#a6e22e">@UiThread</span>
  <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ButterKnifeAcivity_ViewBinding</span><span style="color:#f92672">(</span>ButterKnifeAcivity target<span style="color:#f92672">,</span> View source<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">target</span> <span style="color:#f92672">=</span> target<span style="color:#f92672">;</span>

    target<span style="color:#f92672">.</span><span style="color:#a6e22e">textView</span> <span style="color:#f92672">=</span> Utils<span style="color:#f92672">.</span><span style="color:#a6e22e">findRequiredViewAsType</span><span style="color:#f92672">(</span>source<span style="color:#f92672">,</span> R<span style="color:#f92672">.</span><span style="color:#a6e22e">id</span><span style="color:#f92672">.</span><span style="color:#a6e22e">textView</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;field &#39;textView&#39;&#34;</span><span style="color:#f92672">,</span> TextView<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
  <span style="color:#f92672">}</span>

  <span style="color:#a6e22e">@Override</span>
  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">unbind</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    ButterKnifeAcivity target <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">target</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>target <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> IllegalStateException<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Bindings already cleared.&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">target</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>

    target<span style="color:#f92672">.</span><span style="color:#a6e22e">textView</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
  <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>So, basically using <em>ButterKnife</em> is similar to vanilla approach. The only difference is that we don’t have to write a lot of *findViewById *calls (though we still need to write one line per property — *Binds *annotation — but it is anyway better as we have actual property and view id near to each other).</p>
<p>There is small downside that *ButterKnife *uses reflection to instantiate *ViewBinding *class. But this is usual trade-off between reflection and code generation.</p>
<h3 id="result-1">Result<a href="#result-1" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>To conclude, evaluation of *ButterKnife *approach:</p>
<ul>
<li>one-time initialization (in <em>onCreate</em>)</li>
<li>fast subsequent getters (property keeps reference to <em>View</em>)
+/– quite a lot of boilerplate (still need to define properties, though no need to write a lot of *findViewById *mehod calls, instead just one method bind — but it is needed to add *Binds *annotation to each property)</li>
</ul>
<h2 id="synthetics">Synthetics<a href="#synthetics" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>Same sample using synthetics:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#66d9ef">import</span> kotlinx.android.synthetic.main.activity_main.*

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ExtensionsActivity</span> : AppCompatActivity() {

    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">onCreate</span>(savedInstanceState: Bundle?) {
        <span style="color:#66d9ef">super</span>.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)

        update()
    }

    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">update</span>() {
        textView.text = <span style="color:#e6db74">&#34;Text&#34;</span>
        textView.setTextColor(Color.RED)
        textView.textSize = <span style="color:#ae81ff">14.0f</span>
    }
}
</code></pre></div><p>Generated Java code:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ExtensionsActivity</span> <span style="color:#66d9ef">extends</span> AppCompatActivity <span style="color:#f92672">{</span>
   <span style="color:#66d9ef">private</span> SparseArray _$_findViewCache<span style="color:#f92672">;</span>

   <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">onCreate</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@Nullable</span> Bundle savedInstanceState<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      <span style="color:#66d9ef">super</span><span style="color:#f92672">.</span><span style="color:#a6e22e">onCreate</span><span style="color:#f92672">(</span>savedInstanceState<span style="color:#f92672">);</span>
      <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">setContentView</span><span style="color:#f92672">(-</span>1300009<span style="color:#f92672">);</span>
      <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">update</span><span style="color:#f92672">();</span>
   <span style="color:#f92672">}</span>

   <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">update</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
      TextView var10000 <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>TextView<span style="color:#f92672">)</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">_$_findCachedViewById</span><span style="color:#f92672">(</span>id<span style="color:#f92672">.</span><span style="color:#a6e22e">textView</span><span style="color:#f92672">);</span>
      Intrinsics<span style="color:#f92672">.</span><span style="color:#a6e22e">checkExpressionValueIsNotNull</span><span style="color:#f92672">(</span>var10000<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;textView&#34;</span><span style="color:#f92672">);</span>
      var10000<span style="color:#f92672">.</span><span style="color:#a6e22e">setText</span><span style="color:#f92672">((</span>CharSequence<span style="color:#f92672">)</span><span style="color:#e6db74">&#34;Text&#34;</span><span style="color:#f92672">);</span>
      <span style="color:#f92672">((</span>TextView<span style="color:#f92672">)</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">_$_findCachedViewById</span><span style="color:#f92672">(</span>id<span style="color:#f92672">.</span><span style="color:#a6e22e">textView</span><span style="color:#f92672">)).</span><span style="color:#a6e22e">setTextColor</span><span style="color:#f92672">(-</span>65536<span style="color:#f92672">);</span>
      var10000 <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>TextView<span style="color:#f92672">)</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">_$_findCachedViewById</span><span style="color:#f92672">(</span>id<span style="color:#f92672">.</span><span style="color:#a6e22e">textView</span><span style="color:#f92672">);</span>
      Intrinsics<span style="color:#f92672">.</span><span style="color:#a6e22e">checkExpressionValueIsNotNull</span><span style="color:#f92672">(</span>var10000<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;textView&#34;</span><span style="color:#f92672">);</span>
      var10000<span style="color:#f92672">.</span><span style="color:#a6e22e">setTextSize</span><span style="color:#f92672">(</span>14<span style="color:#f92672">.</span><span style="color:#a6e22e">0F</span><span style="color:#f92672">);</span>
   <span style="color:#f92672">}</span>

   <span style="color:#66d9ef">public</span> View <span style="color:#a6e22e">_$_findCachedViewById</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> var1<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">_$_findViewCache</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
         <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">_$_findViewCache</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SparseArray<span style="color:#f92672">();</span>
      <span style="color:#f92672">}</span>

      View var2 <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>View<span style="color:#f92672">)</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">_$_findViewCache</span><span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>var1<span style="color:#f92672">);</span>
      <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>var2 <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
         var2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">findViewById</span><span style="color:#f92672">(</span>var1<span style="color:#f92672">);</span>
         <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">_$_findViewCache</span><span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span>var1<span style="color:#f92672">,</span> var2<span style="color:#f92672">);</span>
      <span style="color:#f92672">}</span>

      <span style="color:#66d9ef">return</span> var2<span style="color:#f92672">;</span>
   <span style="color:#f92672">}</span>

   <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">_$_clearFindViewByIdCache</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
      <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">_$_findViewCache</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
         <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">_$_findViewCache</span><span style="color:#f92672">.</span><span style="color:#a6e22e">clear</span><span style="color:#f92672">();</span>
      <span style="color:#f92672">}</span>

   <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>Here we have version with *SparseArray *to not have, as discussed above, useless autoboxing of integer keys.</p>
<p>The main issue with generated code is that even as we call three methods on same property sequentially, we still have 3 lookups in view cache (yes, *findViewById *will be called just once — at first time, but why to get value from cache all the time?).</p>
<p>Again, we can work-around this by using <em>.apply</em>, as we did in vanilla approach. Then generated code will be like:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">update</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
   TextView var1 <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>TextView<span style="color:#f92672">)</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">_$_findCachedViewById</span><span style="color:#f92672">(</span>id<span style="color:#f92672">.</span><span style="color:#a6e22e">textView</span><span style="color:#f92672">);</span>
   var1<span style="color:#f92672">.</span><span style="color:#a6e22e">setText</span><span style="color:#f92672">((</span>CharSequence<span style="color:#f92672">)</span><span style="color:#e6db74">&#34;Text&#34;</span><span style="color:#f92672">);</span>
   var1<span style="color:#f92672">.</span><span style="color:#a6e22e">setTextColor</span><span style="color:#f92672">(-</span>65536<span style="color:#f92672">);</span>
   var1<span style="color:#f92672">.</span><span style="color:#a6e22e">setTextSize</span><span style="color:#f92672">(</span>14<span style="color:#f92672">.</span><span style="color:#a6e22e">0F</span><span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>Looks like we’ve improved our code a bit, as now we’ll call cache only once (and if HashMap is used, then we’ll not have two additional boxing of integer primitive).
That actually looks pretty good.</p>
<p>But if we look at generated *dex *byte-code for release build, then it turns out everything is not that easy and straightforward.
Below are two listings, first one is byte-code from decompiled release APK of original example, second one for case with “optimization” of <em>.apply</em>.</p>
<p><strong>Original</strong>:</p>
<pre><code>.class public final Lcom/krossovochkin/butterknifetest/ExtensionsActivity;
.super Landroidx/appcompat/app/c;


# instance fields
.field private j:Ljava/util/HashMap;


# direct methods
.method public constructor &lt;init&gt;()V
    .registers 1

    invoke-direct {p0}, Landroidx/appcompat/app/c;-&gt;&lt;init&gt;()V

    return-void
.end method

.method private a(I)Landroid/view/View;
    .registers 4

    iget-object v0, p0, Lcom/krossovochkin/butterknifetest/ExtensionsActivity;-&gt;j:Ljava/util/HashMap;

    if-nez v0, :cond_b

    new-instance v0, Ljava/util/HashMap;

    invoke-direct {v0}, Ljava/util/HashMap;-&gt;&lt;init&gt;()V

    iput-object v0, p0, Lcom/krossovochkin/butterknifetest/ExtensionsActivity;-&gt;j:Ljava/util/HashMap;

    :cond_b
    iget-object v0, p0, Lcom/krossovochkin/butterknifetest/ExtensionsActivity;-&gt;j:Ljava/util/HashMap;

    invoke-static {p1}, Ljava/lang/Integer;-&gt;valueOf(I)Ljava/lang/Integer;

    move-result-object v1

    invoke-virtual {v0, v1}, Ljava/util/HashMap;-&gt;get(Ljava/lang/Object;)Ljava/lang/Object;

    move-result-object v0

    check-cast v0, Landroid/view/View;

    if-nez v0, :cond_26

    invoke-virtual {p0, p1}, Landroidx/fragment/app/d;-&gt;findViewById(I)Landroid/view/View;

    move-result-object v0

    iget-object v1, p0, Lcom/krossovochkin/butterknifetest/ExtensionsActivity;-&gt;j:Ljava/util/HashMap;

    invoke-static {p1}, Ljava/lang/Integer;-&gt;valueOf(I)Ljava/lang/Integer;

    move-result-object p1

    invoke-virtual {v1, p1, v0}, Ljava/util/HashMap;-&gt;put(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;

    :cond_26
    return-object v0
.end method


# virtual methods
.method public final onCreate(Landroid/os/Bundle;)V
    .registers 3

    invoke-super {p0, p1}, Landroidx/appcompat/app/c;-&gt;onCreate(Landroid/os/Bundle;)V

    const p1, 0x7f0a001e

    invoke-virtual {p0, p1}, Lcom/krossovochkin/butterknifetest/ExtensionsActivity;-&gt;setContentView(I)V

    sget p1, Lcom/krossovochkin/butterknifetest/a$a;-&gt;textView:I

    invoke-direct {p0, p1}, Lcom/krossovochkin/butterknifetest/ExtensionsActivity;-&gt;a(I)Landroid/view/View;

    move-result-object p1

    check-cast p1, Landroid/widget/TextView;

    const-string v0, &quot;textView&quot;

    invoke-static {p1, v0}, La/a/a/a;-&gt;a(Ljava/lang/Object;Ljava/lang/String;)V

    const-string v0, &quot;Text&quot;

    check-cast v0, Ljava/lang/CharSequence;

    invoke-virtual {p1, v0}, Landroid/widget/TextView;-&gt;setText(Ljava/lang/CharSequence;)V

    sget p1, Lcom/krossovochkin/butterknifetest/a$a;-&gt;textView:I

    invoke-direct {p0, p1}, Lcom/krossovochkin/butterknifetest/ExtensionsActivity;-&gt;a(I)Landroid/view/View;

    move-result-object p1

    check-cast p1, Landroid/widget/TextView;

    const/high16 v0, -0x10000

    invoke-virtual {p1, v0}, Landroid/widget/TextView;-&gt;setTextColor(I)V

    sget p1, Lcom/krossovochkin/butterknifetest/a$a;-&gt;textView:I

    invoke-direct {p0, p1}, Lcom/krossovochkin/butterknifetest/ExtensionsActivity;-&gt;a(I)Landroid/view/View;

    move-result-object p1

    check-cast p1, Landroid/widget/TextView;

    const-string v0, &quot;textView&quot;

    invoke-static {p1, v0}, La/a/a/a;-&gt;a(Ljava/lang/Object;Ljava/lang/String;)V

    const/high16 v0, 0x41600000    # 14.0f

    invoke-virtual {p1, v0}, Landroid/widget/TextView;-&gt;setTextSize(F)V

    return-void
.end method
</code></pre><p><strong>With .<em>apply</em> “optimization”:</strong></p>
<pre><code>.class public final Lcom/krossovochkin/butterknifetest/ExtensionsActivity;
.super Landroidx/appcompat/app/c;


# instance fields
.field private j:Ljava/util/HashMap;


# direct methods
.method public constructor &lt;init&gt;()V
    .registers 1

    invoke-direct {p0}, Landroidx/appcompat/app/c;-&gt;&lt;init&gt;()V

    return-void
.end method


# virtual methods
.method public final onCreate(Landroid/os/Bundle;)V
    .registers 4

    invoke-super {p0, p1}, Landroidx/appcompat/app/c;-&gt;onCreate(Landroid/os/Bundle;)V

    const p1, 0x7f0a001e

    invoke-virtual {p0, p1}, Lcom/krossovochkin/butterknifetest/ExtensionsActivity;-&gt;setContentView(I)V

    sget p1, Lcom/krossovochkin/butterknifetest/a$a;-&gt;textView:I

    iget-object v0, p0, Lcom/krossovochkin/butterknifetest/ExtensionsActivity;-&gt;j:Ljava/util/HashMap;

    if-nez v0, :cond_16

    new-instance v0, Ljava/util/HashMap;

    invoke-direct {v0}, Ljava/util/HashMap;-&gt;&lt;init&gt;()V

    iput-object v0, p0, Lcom/krossovochkin/butterknifetest/ExtensionsActivity;-&gt;j:Ljava/util/HashMap;

    :cond_16
    iget-object v0, p0, Lcom/krossovochkin/butterknifetest/ExtensionsActivity;-&gt;j:Ljava/util/HashMap;

    invoke-static {p1}, Ljava/lang/Integer;-&gt;valueOf(I)Ljava/lang/Integer;

    move-result-object v1

    invoke-virtual {v0, v1}, Ljava/util/HashMap;-&gt;get(Ljava/lang/Object;)Ljava/lang/Object;

    move-result-object v0

    check-cast v0, Landroid/view/View;

    if-nez v0, :cond_31

    invoke-virtual {p0, p1}, Landroidx/fragment/app/d;-&gt;findViewById(I)Landroid/view/View;

    move-result-object v0

    iget-object v1, p0, Lcom/krossovochkin/butterknifetest/ExtensionsActivity;-&gt;j:Ljava/util/HashMap;

    invoke-static {p1}, Ljava/lang/Integer;-&gt;valueOf(I)Ljava/lang/Integer;

    move-result-object p1

    invoke-virtual {v1, p1, v0}, Ljava/util/HashMap;-&gt;put(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;

    :cond_31
    check-cast v0, Landroid/widget/TextView;

    const-string p1, &quot;Text&quot;

    check-cast p1, Ljava/lang/CharSequence;

    invoke-virtual {v0, p1}, Landroid/widget/TextView;-&gt;setText(Ljava/lang/CharSequence;)V

    const/high16 p1, -0x10000

    invoke-virtual {v0, p1}, Landroid/widget/TextView;-&gt;setTextColor(I)V

    const/high16 p1, 0x41600000    # 14.0f

    invoke-virtual {v0, p1}, Landroid/widget/TextView;-&gt;setTextSize(F)V

    return-void
.end method
</code></pre><p>Again, few questions and observations:</p>
<ul>
<li>
<p>It turned out that <em>HashMap</em> is in the byte-code, though we added in config that we want to use <em>SparseArray <em>(and generated Java code was exactly showing us that we have <em>SparseArray</em>).
So it seems optimization during release compilation replaced <em>SparseArray <em>with <em>HashMap <em>(for unknown reason)
So we not only have <em><strong>.field private j:Ljava/util/HashMap;</strong></em> we also have autoboxing in place</em></em></em> invoke-static {p1}, Ljava/lang/Integer;-&gt;valueOf(I)Ljava/lang/Integer;</em></em></em>
So looks like our optimization is really good as we avoid useless autoboxing?
Interesting stuff, though I don’t know why it happens</p>
</li>
<li>
<p>Byte-code for our *apply *“optimization” is shorter. We exactly see that in first listing there are getters from *HashMap *coming first and only then setters on *TextView *are called, when in second listing setters on <em>TextView</em> are called almost one by one.
Additional thing is that by not calling view cache multiple times <em>ProGuard</em> was able to inline code related to view cache directly to *onCreate *method (so we don’t have method to call view cache by id)</p>
</li>
</ul>
<p>So it seems our apply “optimization” worked and we have smaller byte-code, also avoided additional autoboxing in HashMap and not calling view cache multiple times.
Is it enough to recommend using apply “optimization”? I think no. Though there is some impact in the resulting release byte-code it is still matter of optimizations on byte-code level. We usually should not do any code tricks to make byte-code faster.
Even if right now solution works, then we need to check over time that this optimization is still working.
Otherwise it is better to have clean code.</p>
<h3 id="result-2">Result<a href="#result-2" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>To conclude, evaluation of Synthetics approach:</p>
<ul>
<li>no boilerplate (automatic properties creation and binding*)
+/– dynamic initialization (views are not binded in *onCreate *but on first call. Whether it is a plus or not actually depends)
– slow getters (either *HashMap *with autoboxing of key or relatively slow lookup in *SparseArray *— which seems still converted to *HashMap *in release; possible delay for first time get)</li>
</ul>
<h2 id="conclusion">Conclusion<a href="#conclusion" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>So, use or not use?</p>
<p>Actually it depends.
I think synthetics is pretty useful tool for common cases when you have simple screens and not using e.g. ‘includes’ and other stuff.
If one needs more control, then definitely vanilla approach is better (though has more boilerplate).
ButterKnife looks as something between the two and because of that [still] a good tool to work with.</p>
<p>Though next generation of helper tools for working with view bindings I would expect to be built on top of the idea of ButterKnife and just additionally generate properties with Bind annotations automatically.</p>
<p>Synthetics approach seems a bit too broad with a lot of things underneath, with less control. Approach which only looks good for beginners (as you don’t need to think about many things), though dangerous and actually seems to be designed for professionals.
Synthetics approach definitely has the worst performance comparing to vanilla or ButterKnife, but I hope that some optimizations will be done in the future so it will become really good approach.</p>
<p>Happy coding!</p>

      </div></div>

  
  
<div class="pagination">
    <div class="pagination__title">
        <span class="pagination__title-h">Read other posts</span>
        <hr />
    </div>
    <div class="pagination__buttons">
        
        <span class="button previous">
            <a href="https://krossovochkin.github.io/posts/2019_04_08_dart_language_bad_design_choices/">
                <span class="button__icon">←</span>
                <span class="button__text">Dart language bad design choices</span>
            </a>
        </span>
        
        
        <span class="button next">
            <a href="https://krossovochkin.github.io/posts/2018_09_13_kotlin_java_interop_function_references_and_sam_conversions/">
                <span class="button__text">Kotlin-Java interop: function references and SAM conversions</span>
                <span class="button__icon">→</span>
            </a>
        </span>
        
    </div>
</div>

  

  

</div>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright copyright--user">
        <span>© 2020 Vasya Drobushkov</span>
    
        <span>:: Theme made by <a href="https://twitter.com/panr">panr</a></span>
      </div>
  </div>
  <div class="footer__inner">
    <div class="copyright copyright--user">
      <a href="https://www.facebook.com/vasya.drobushkov">Facebook</a><a href="https://twitter.com/krossovochkin">Twitter</a>
    </div>
  </div>
</footer>

<script src="https://krossovochkin.github.io/assets/main.js"></script>
<script src="https://krossovochkin.github.io/assets/prism.js"></script>





  
</div>

</body>
</html>
